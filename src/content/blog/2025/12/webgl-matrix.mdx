---
title: WebGLã§ä½¿ã†è¡Œåˆ—æ¼”ç®—ã®å‚™å¿˜éŒ²
slug: webgl-matrix
pubDate: 2025-12-20
category: å‹‰å¼·ãƒãƒ¼ãƒˆ
tags:
  - æ•°å­¦
description: è¡Œåˆ—å®Œå…¨ã«ç†è§£ã—ãŸğŸ§®
---

## ã¯ã˜ã‚ã«

ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨ã›ãšç´ ã® WebGL ã§æ›¸ã‘ã‚‹ã‚ˆã†ã«ãªã‚ŠãŸã„ã¨æ€ã„ã€æœ€è¿‘ã¯ã„ã‚ã„ã‚å‹‰å¼·ã—ã¦ã¾ã™ã€‚WebGL ã‚’è§¦ã‚‹ã†ãˆã§è¡Œåˆ—æ¼”ç®—ã¯é¿ã‘ã¦ã¯é€šã‚Œã¾ã›ã‚“ã€‚WebGL ç”¨ã®è¡Œåˆ—æ¼”ç®—ã®æ—¢å­˜ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã ã¨ glMatrix ãŒã‚ã‚Šã¾ã™ãŒã€ä»Šå›ã¯ç·šå½¢ä»£æ•°ã®å‹‰å¼·ã‚‚å…¼ã­ã¦è‡ªä½œã§ä½œã£ã¦ã¿ã¾ã—ãŸã€‚(è‡ªä½œã¨ã„ã£ã¦ã‚‚ã€ã»ã¼ã»ã¼ OGL ã®æ•°å­¦æ¼”ç®—ç³»ã‚’ã‚‚ã£ã¦æ¥ã¦ã„ã‚‹ã ã‘ã§ã™ãŒ)

è¶³ã—ç®—ãªã©ã®ç°¡å˜ãªã®ã¯é£›ã°ã—ã¦ã€ä½•ã‚’ã‚„ã£ã¦ã‚‹ã‹å¿˜ã‚Œãã†ãªå‡¦ç†ã«ã¤ã„ã¦å‚™å¿˜éŒ²çš„ã«æ›¸ã„ã¦ã„ãã¾ã™ã€‚é•·ããªã‚‹ã®ã§ã€ä¸»ã« 3x3 è¡Œåˆ—ã‚’ã¿ã¦ã„ãã¾ã™ã€‚

æ•°å­¦æ¼”ç®—ç³»ã®ã‚³ãƒ¼ãƒ‰ã¯ä»¥ä¸‹ã«ç½®ã„ã¦ã¾ã™ã€‚

https://github.com/nono-k/webgl-study-note/tree/main/src/lib/webgl/math

## 3x3 è¡Œåˆ—(Mat3)

3x3 (Mat3)è¡Œåˆ—ã®ã‚¯ãƒ©ã‚¹ã¯æ¬¡ã®ã‚ˆã†ã«ã—ã¦ã¾ã™ã€‚
æ¼”ç®—ç³»ã®é–¢æ•°ã¯`Mat3Func`ã§æ›¸ã„ã¦ã„ã¾ã™ã€‚

```ts title="Mat3.ts"
import * as Mat3Func from "./functions/Mat3Func";

export class Mat3 extends Array<number> {
  constructor(
    m00 = 1,
    m01 = 0,
    m02 = 0,
    m10 = 0,
    m11 = 1,
    m12 = 0,
    m20 = 0,
    m21 = 0,
    m22 = 1
  ) {
    super(m00, m01, m02, m10, m11, m12, m20, m21, m22);
  }
  // ...
}
```

æ•°å¼ã§æ›¸ãã¨æ¬¡ã®ã‚ˆã†ãªè¡Œåˆ—è¡¨è¨˜ã«ãªã‚Šã¾ã™ã€‚

$$
M =
\begin{bmatrix}
m_{00} & m_{10} & m_{20} \\
m_{01} & m_{11} & m_{21} \\
m_{02} & m_{12} & m_{22}
\end{bmatrix}
$$

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã¯å˜ä½è¡Œåˆ—ã«ãªã‚Šã¾ã™ã€‚

$$
I =
\begin{bmatrix}
1 & 0 & 0 \\
0 & 1 & 0 \\
0 & 0 & 1
\end{bmatrix}
$$

ã“ã“ã‹ã‚‰ã¯ã€`Mat3Func`å†…ã‚’ã¿ã¦ã„ãã¾ã™ã€‚

### å¹³è¡Œç§»å‹•(translate)

å¹³è¡Œç§»å‹•(x,y)ã‚’è¡¨ã™è¡Œåˆ— T ã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

$$
T =
\begin{bmatrix}
1 & 0 & x \\
0 & 1 & y \\
0 & 0 & 1
\end{bmatrix}
$$

ç§»å‹•å¾Œã®è¡Œåˆ—$M'$ã¯ã€æ¬¡ã®ã‚ˆã†ãªè¡Œåˆ—ã®æ›ã‘ç®—ã§æ±‚ã¾ã‚Šã¾ã™ã€‚

$$
M' = M \cdot T =
\begin{bmatrix}
m_{00} & m_{10} & m_{20} \\
m_{01} & m_{11} & m_{21} \\
m_{02} & m_{12} & m_{22}
\end{bmatrix}
\cdot
\begin{bmatrix}
1 & 0 & x \\
0 & 1 & y \\
0 & 0 & 1
\end{bmatrix}
=
\begin{bmatrix}
m_{00} & m_{10} & m_{00}x + m_{10}y + m_{20}\\
m_{01} & m_{11} & m_{01}x + m_{11}y + m_{21} \\
m_{02} & m_{12} & m_{02}x + m_{12}y + m_{22}
\end{bmatrix}
$$

ä»¥ä¸Šã‚’ã‚³ãƒ¼ãƒ‰ã§æ›¸ãã¨æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```ts title="translate"
export function translate(out: Mat3, a: Mat3, v: Vec2): Mat3 {
  const a00 = a[0],
    a01 = a[1],
    a02 = a[2],
    a10 = a[3],
    a11 = a[4],
    a12 = a[5],
    a20 = a[6],
    a21 = a[7],
    a22 = a[8],
    x = v[0],
    y = v[1];

  out[0] = a00;
  out[1] = a01;
  out[2] = a02;

  out[3] = a10;
  out[4] = a11;
  out[5] = a12;

  out[6] = x * a00 + y * a10 + a20;
  out[7] = x * a01 + y * a11 + a21;
  out[8] = x * a02 + y * a12 + a22;
  return out;
}
```

### å›è»¢(rotate)

è§’åº¦$\theta$ã®å›è»¢è¡Œåˆ—$R(\theta)$ã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

$$
R(\theta) =
\begin{bmatrix}
\cos\theta & -\sin\theta & 0 \\
\sin\theta & \cos\theta & 0 \\
0 & 0 & 1
\end{bmatrix}
$$

å›è»¢å¾Œã®è¡Œåˆ—$M'$ã¯ã€æ¬¡ã®ã‚ˆã†ãªè¡Œåˆ—ã®æ›ã‘ç®—ã§æ±‚ã¾ã‚Šã¾ã™ã€‚

$$
M' = M \cdot R(\theta) =
\begin{bmatrix}
m_{00} & m_{10} & m_{20} \\
m_{01} & m_{11} & m_{21} \\
m_{02} & m_{12} & m_{22}
\end{bmatrix}
\cdot
\begin{bmatrix}
\cos\theta & -\sin\theta & 0 \\
\sin\theta & \cos\theta & 0 \\
0 & 0 & 1
\end{bmatrix}
$$

è¨ˆç®—ã™ã‚‹ã¨

$$
M' =
\begin{bmatrix}
m_{00}\cos\theta + m_{10}\sin\theta & -m_{00}\sin\theta + m_{10}\cos\theta & m_{20} \\
m_{01}\cos\theta + m_{11}\sin\theta & -m_{01}\sin\theta + m_{11}\cos\theta & m_{21} \\
m_{02}\cos\theta + m_{12}\sin\theta & -m_{02}\sin\theta + m_{12}\cos\theta & m_{22}
\end{bmatrix}
$$

ä»¥ä¸Šã‚’ã‚³ãƒ¼ãƒ‰ã§æ›¸ãã¨æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```ts title="rotate"
export function rotate(out: Mat3, a: Mat3, rad: number): Mat3 {
  const a00 = a[0],
    a01 = a[1],
    a02 = a[2],
    a10 = a[3],
    a11 = a[4],
    a12 = a[5],
    a20 = a[6],
    a21 = a[7],
    a22 = a[8],
    s = Math.sin(rad),
    c = Math.cos(rad);

  out[0] = c * a00 + s * a10;
  out[1] = c * a01 + s * a11;
  out[2] = c * a02 + s * a12;

  out[3] = c * a10 - s * a00;
  out[4] = c * a11 - s * a01;
  out[5] = c * a12 - s * a02;

  out[6] = a20;
  out[7] = a21;
  out[8] = a22;
  return out;
}
```

### æ‹¡å¤§(scale)

ã‚¹ã‚±ãƒ¼ãƒ«è¡Œåˆ—$S$ã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

$$
S =
\begin{bmatrix}
s_x & 0 & 0 \\
0 & s_y & 0 \\
0 & 0 & 1
\end{bmatrix}
$$

å›è»¢å¾Œã®è¡Œåˆ—$M'$ã¯ã€æ¬¡ã®ã‚ˆã†ãªè¡Œåˆ—ã®æ›ã‘ç®—ã§æ±‚ã¾ã‚Šã¾ã™ã€‚

$$
M' = M \cdot S
\begin{bmatrix}
m_{00} & m_{10} & m_{20} \\
m_{01} & m_{11} & m_{21} \\
m_{02} & m_{12} & m_{22}
\end{bmatrix}
\cdot
\begin{bmatrix}
s_x & 0 & 0 \\
0 & s_y & 0 \\
0 & 0 & 1
\end{bmatrix}
$$

è¨ˆç®—ã™ã‚‹ã¨

$$
M' =
\begin{bmatrix}
m_{00}s_x & m_{10}s_y & m_{20} \\
m_{01}s_x & m_{11}s_y & m_{21} \\
m_{02}s_x & m_{12}s_y & m_{22}
\end{bmatrix}
$$

ä»¥ä¸Šã‚’ã‚³ãƒ¼ãƒ‰ã§æ›¸ãã¨æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```ts title="scale"
export function scale(out: Mat3, a: Mat3, v: Vec2): Mat3 {
  const x = v[0];
  const y = v[1];

  out[0] = x * a[0];
  out[1] = x * a[1];
  out[2] = x * a[2];

  out[3] = y * a[3];
  out[4] = y * a[4];
  out[5] = y * a[5];

  out[6] = a[6];
  out[7] = a[7];
  out[8] = a[8];
  return out;
}
```

### è»¢ç½®è¡Œåˆ—(transpose)

è»¢ç½®è¡Œåˆ—ã¯è¡Œã¨åˆ—ã‚’å…¥ã‚Œæ›¿ãˆãŸè¡Œåˆ—ã«ãªã‚Šã¾ã™ã€‚
è¡Œåˆ— M ã®è»¢ç½®è¡Œåˆ—ã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

$$
M =
\begin{bmatrix}
m_{00} & m_{10} & m_{20} \\
m_{01} & m_{11} & m_{21} \\
m_{02} & m_{12} & m_{22}
\end{bmatrix}
\Rightarrow
M^T =
\begin{bmatrix}
m_{00} & m_{01} & m_{02} \\
m_{10} & m_{11} & m_{12} \\
m_{20} & m_{21} & m_{22}
\end{bmatrix}
$$

ã‚³ãƒ¼ãƒ‰ã§æ›¸ãã¨æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```ts title="transpose"
export function transpose(out: Mat3, a: Mat3): Mat3 {
  if (out === a) {
    // ä¸Šæ›¸ãå‰ã«é€€é¿
    const a01 = a[1];
    const a02 = a[2];
    const a12 = a[5];

    out[1] = a[3];
    out[2] = a[6];
    out[3] = a01;
    out[5] = a[7];
    out[6] = a02;
    out[7] = a12;
  } else {
    out[0] = a[0];
    out[1] = a[3];
    out[2] = a[6];
    out[3] = a[1];
    out[4] = a[4];
    out[5] = a[7];
    out[6] = a[2];
    out[7] = a[5];
    out[8] = a[8];
  }
  return out;
}
```

ã“ã“ã§ã€`out === a`ã®å ´åˆã¯ã€å¯¾è§’æˆåˆ†ã¯å¤‰ã‚ã‚‰ãªã„ã®ã§ã€ãã‚Œä»¥å¤–ã®æˆåˆ†ã‚’å…¥ã‚Œæ›¿ãˆã¾ã™ã€‚

### è¡Œåˆ—å¼(determinant)

3x3 ã®è¡Œåˆ—å¼ã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

$$
det(M) = m_{00}(m_{11}m_{22} - m_{12}m_{21}) - m_{01}(m_{12}m_{20} - m_{10}m_{22}) + m_{02}(m_{10}m_{21} - m_{11}m_{20})
$$

ã‚³ãƒ¼ãƒ‰ã§ã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```ts title="determinant"
export function determinant(a: Mat3): number {
  const a00 = a[0],
    a01 = a[1],
    a02 = a[2],
    a10 = a[3],
    a11 = a[4],
    a12 = a[5],
    a20 = a[6],
    a21 = a[7],
    a22 = a[8];

  return (
    a00 * (a11 * a22 - a12 * a21) +
    a01 * (a12 * a20 - a10 * a22) +
    a02 * (a10 * a21 - a11 * a20)
  );
}
```

### é€†è¡Œåˆ—(inverse)

è¡Œåˆ— M ã®é€†è¡Œåˆ—$M^{-1}$ã‚’æ›ã‘ãŸã¨ãã«ã€å˜ä½è¡Œåˆ— I ã«ãªã‚‹ã‚ˆã†ãªè¡Œåˆ—$M^{-1}$ã‚’é€†è¡Œåˆ—ã¨ã„ã„ã¾ã™ã€‚

$$
M \cdot M^{-1} = I
$$

è¡Œåˆ—å¼ã‚’$det$ã¨ã™ã‚‹ã¨ã€é€†è¡Œåˆ—$M^{-1}$ã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

$$
M^{-1} \frac{1}{det}
\begin{bmatrix}
(m_{11}m_{22} - m_{12}m_{21}) & (m_{20}m_{12} - m_{10}m_{22}) & (m_{10}m_{21} - m_{20}m_{11}) \\
(m_{02}m_{21} - m_{01}m_{22}) & (m_{00}m_{22} - m_{02}m_{20}) & (m_{20}m_{01} - m_{00}m_{21}) \\
(m_{01}m_{12} - m_{02}m_{11}) & (m_{02}m_{10} - m_{00}m_{12}) & (m_{00}m_{11} - m_{01}m_{10})
\end{bmatrix}
$$

ã‚³ãƒ¼ãƒ‰ã§æ›¸ãã¨æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```ts title="inverse"
export function invert(out: Mat3, a: Mat3): Mat3 {
  const a00 = a[0],
    a01 = a[1],
    a02 = a[2],
    a10 = a[3],
    a11 = a[4],
    a12 = a[5],
    a20 = a[6],
    a21 = a[7],
    a22 = a[8];

  const b01 = a11 * a22 - a12 * a21;
  const b11 = a12 * a20 - a10 * a22;
  const b21 = a10 * a21 - a11 * a20;

  let det = a00 * b01 + a01 * b11 + a02 * b21;
  det = 1.0 / det;

  out[0] = b01 * det;
  out[1] = (a02 * a21 - a01 * a22) * det;
  out[2] = (a01 * a12 - a02 * a11) * det;
  out[3] = b11 * det;
  out[4] = (a00 * a22 - a02 * a20) * det;
  out[5] = (a02 * a10 - a00 * a12) * det;
  out[6] = b21 * det;
  out[7] = (a01 * a20 - a00 * a21) * det;
  out[8] = (a00 * a11 - a01 * a10) * det;
  return out;
}
```

## 4x4 è¡Œåˆ—(Mat4)

4x4 (Mat4)è¡Œåˆ—ã®ã‚¯ãƒ©ã‚¹ã¯æ¬¡ã®ã‚ˆã†ã«ã—ã¦ã¾ã™ã€‚æ¼”ç®—ç³»ã®é–¢æ•°ã¯`Mat4Func`ã§æ›¸ã„ã¦ã„ã¾ã™ã€‚

```ts title="Mat4"
import * as Mat4Func from "./functions/Mat4Func";

export class Mat4 extends Array<number> {
  constructor(
    m00 = 1,
    m01 = 0,
    m02 = 0,
    m03 = 0,
    m10 = 0,
    m11 = 1,
    m12 = 0,
    m13 = 0,
    m20 = 0,
    m21 = 0,
    m22 = 1,
    m23 = 0,
    m30 = 0,
    m31 = 0,
    m32 = 0,
    m33 = 1
  ) {
    // åŒæ§˜ã«super()ã™ã‚‹
  }
  // ...
}
```

4x4 è¡Œåˆ—ã®æ¼”ç®—ã¯æ™‚é–“ãŒã‚ã‚‹ã¨ãã«æ›´æ–°ã—ã¾ã™ã€‚
